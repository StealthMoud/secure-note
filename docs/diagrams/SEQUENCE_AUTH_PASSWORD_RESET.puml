@startuml
title Password Reset Sequence Diagram

actor User
participant "Frontend" as FE
participant "API Gateway" as API
participant "Auth Controller" as Ctrl
database "Database" as DB
participant "Email Service" as Email
participant "Security Log" as Log

== Request Reset ==
User -> FE: Forgot Password
FE -> API: POST /auth/request-password-reset
API -> Ctrl: Forward Request

Ctrl -> DB: Find User by Email
activate DB
DB --> Ctrl: User found/not found
deactivate DB

alt User Found
    Ctrl -> DB: Save Reset Token
    Ctrl -> Email: Send Reset Link
    Email --> Ctrl: Sent
end
Ctrl --> API: Success (Always 200 for security)
API --> FE: Show "If email exists..."

== Reset Password ==
User -> FE: Click Link & Enter New Password
FE -> API: POST /auth/reset-password
API -> Ctrl: Forward Request
Ctrl -> DB: Verify Token
alt Valid
    Ctrl -> DB: Update Password & Clear Token
    Ctrl -> Log: Log Password Reset
    Ctrl --> API: Success
    API --> FE: Show Success
else Invalid/Expired
    Ctrl --> API: Error
    API --> FE: Show Error
end

@enduml
