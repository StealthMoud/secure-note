@startuml SecureNote_Architecture

title SecureNote - Complete System Architecture

' Define color scheme
skinparam backgroundColor #f5f5f5
skinparam componentBackgroundColor #e1f5ff
skinparam componentBorderColor #01579b
skinparam databaseBackgroundColor #fff3e0
skinparam databaseBorderColor #e65100
skinparam packageBackgroundColor #f3e5f5
skinparam packageBorderColor #4a148c

package "Frontend - Next.js/React/TypeScript" #e8f4f8 {
    package "App Router (src/app)" #e3f2fd {
        component "(auth)" as AuthGroup
        component "(dashboard)" as DashGroup
        component "(admin)" as AdminGroup
        component "Layout & Globals" as RootLayout
    }
    
    package "Features" #e3f2fd {
        component "Auth Logic" as AuthLogic
        component "Notes Logic" as NotesLogic
        component "Friends Logic" as FriendsLogic
    }
    
    package "Services (src/services)" #e3f2fd {
        component "AuthService" as AuthService
        component "NotesService" as NotesService
        component "UsersService" as UsersService
        component "AdminService" as AdminService
        component "API Client (Axios)" as APIClient
    }
    
    package "Hooks (src/hooks)" #e3f2fd {
        component "useAuthSettings" as useAuthSettings
        component "useUserSettings" as useUserSettings
        component "ProtectedRoute" as ProtectedRoute
    }
    
    package "Context (src/context)" #e3f2fd {
        component "DashboardContext" as DashboardContext
        component "AdminContext" as AdminContext
        component "SharedContext" as SharedContext
    }
}

package "Backend - Express.js/Node.js" #fff3e0 {
    package "Routes" #ffe0b2 {
        component "Auth Routes" as AuthRoutes
        component "Users Routes" as UsersRoutes
        component "Notes Routes" as NotesRoutes
        component "Admin Routes" as AdminRoutes
        component "TOTP Routes" as TOTPRoutes
        component "Sharing Routes" as SharingRoutes
        component "Export Routes" as ExportRoutes
    }
    
    package "Controllers" #ffe0b2 {
        component "AuthController" as AuthController
        component "UserController" as UserController
        component "NoteController" as NoteController
        component "AdminController" as AdminController
    }
    
    package "Models (Mongoose)" #fff3e0 {
        database "User" as UserModel
        database "Note" as NoteModel
        database "SecurityLog" as SecurityLogModel
        database "Broadcast" as BroadcastModel
    }
    
    package "Middleware Stack" #ffe0b2 {
        component "Security (Helmet/CORS)" as SecurityMW
        component "Rate Limiting" as RateLimiting
        component "Sanitization" as Sanitization
        component "Auth (Passport/JWT)" as AuthMiddleware
    }
    
    package "Internal Services" #ffe0b2 {
        component "Encryption Service" as EncryptionService
        component "Email Service" as EmailService
        component "Token Service" as TokenService
    }
    
    package "External" #ffe0b2 {
        component "Passport Auth" as PassportAuth
        component "Nodemailer" as Nodemailer
    }
}

database "MongoDB" #fff3e0 {
    note "NoSQL Database" as DBNote
}

package "Docker & Deployment" #f3e5f5 {
    component "Backend Container" as BackendContainer
    component "Frontend Container" as FrontendContainer
    component "docker-compose.yml" as ComposeFile
    component "docker-compose.prod.yml" as ComposeFileProd
}

' Frontend to Backend connections
LoginPage --> useLoginLogic
RegisterPage --> useRegisterLogic
DashboardPage --> DashboardContext
DashboardPage --> DashboardContent
NotesPage --> NotesSection
AdminPage --> AdminContext
FriendsPage --> FriendsSection
ProfilePage --> ProfilePage
SettingsPage --> SettingsSection

useLoginLogic --> AuthService
useRegisterLogic --> AuthService
useAuthSettings --> AuthService
useForgotPasswordLogic --> AuthService
useVerifyEmailLogic --> AuthService
useUserSettings --> UsersService

ProtectedRoute --> AuthService
DashboardContent --> NotesService
NotesSection --> NotesService
FriendsSection --> UsersService
SettingsSection --> UsersService
AdminPage --> AdminService

AuthService --> APIClient
NotesService --> APIClient
UsersService --> APIClient
AdminService --> APIClient

APIClient --> AuthRoutes
APIClient --> UsersRoutes
APIClient --> NotesRoutes
APIClient --> AdminRoutes
APIClient --> TOTPRoutes
APIClient --> SharingRoutes
APIClient --> ExportRoutes

' Backend internal connections
AuthRoutes --> AuthController
UsersRoutes --> UserController
NotesRoutes --> NoteController
AdminRoutes --> AdminController

AuthController --> UserModel
AuthController --> SecurityLogModel
AuthController --> AuthMiddleware
AuthController --> PassportAuth
AuthController --> GoogleOAuth
AuthController --> GitHubOAuth
AuthController --> Nodemailer
AuthController --> EncryptionUtils

UserController --> UserModel
UserController --> SecurityLogModel
UserController --> VerificationMiddleware
UserController --> EncryptionUtils
UserController --> Nodemailer

NoteController --> NoteModel
NoteController --> UserModel
NoteController --> SecurityLogModel
NoteController --> EncryptionUtils
NoteController --> PDFKit

AdminController --> UserModel
AdminController --> NoteModel
AdminController --> SecurityLogModel

TOTPRoutes --> SpeakeasyLib
TOTPRoutes --> QRCodeLib
TOTPRoutes --> UserModel

SharingRoutes --> NoteModel
SharingRoutes --> UserModel
SharingRoutes --> SecurityLogModel
SharingRoutes --> EncryptionUtils
SharingRoutes --> Nodemailer

ExportRoutes --> NoteModel
ExportRoutes --> PDFKit

AuthMiddleware --> UserModel
VerificationMiddleware --> UserModel

RateLimiting --> AuthRoutes
HelmetSecurity --> AuthRoutes
CORSMiddleware --> AuthRoutes

DBConfig --> MongoDB
UserModel --> MongoDB
NoteModel --> MongoDB
SecurityLogModel --> MongoDB

BackendContainer --> AuthRoutes
FrontendContainer --> LoginPage

ComposeFile --> BackendContainer
ComposeFile --> FrontendContainer

PassportConfig --> PassportAuth
PassportConfig --> GoogleOAuth
PassportConfig --> GitHubOAuth

@enduml
