@startuml Note_Export
title Note Export Sequence Diagram

actor User
participant "Frontend" as FE
participant "API Gateway" as API
participant "Export Controller" as Ctrl
participant "Encryption Service" as Enc
database "Database" as DB

User -> FE: Request Export (PDF/MD/TXT)
FE -> API: GET /export/{id}?format=...
API -> Ctrl: Check Permissions
Ctrl -> DB: Fetch Note & User Keys
Ctrl -> Enc: Decrypt Note (using Hybrid logic)
note right of Enc: Use Symmetric Key encrypted\nwith User PK
Enc --> Ctrl: Plain Text content

Ctrl -> Ctrl: Generate File (PDF generation etc.)
Ctrl --> API: Download Stream
API --> FE: File
FE --> User: Save File

@enduml
